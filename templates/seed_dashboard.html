<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>种子推荐面板 - AgriDec</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <style>
        .navbar-brand {
            font-weight: bold;
            color: #52c41a !important;
        }
        .btn-primary {
            background-color: #52c41a;
            border-color: #52c41a;
        }
        .btn-primary:hover {
            background-color: #389e0d;
            border-color: #389e0d;
        }
        .seed-card {
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            margin-bottom: 20px;
        }
        .seed-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .price-trend {
            color: #52c41a;
            font-weight: bold;
        }
        .price-trend.down {
            color: #ff4d4f;
        }
        .recommendation-badge {
            background: linear-gradient(45deg, #52c41a, #73d13d);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-seedling"></i> AgriDec
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">数据看板</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/seed-dashboard">种子推荐</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/weather-dashboard">天气适宜度</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/machine-comparison">农具对比</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/farming-calendar">农事日历</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/purchase-module">农资采购</a>
                    </li>
                </ul>

                <div class="navbar-nav">
                    {% if current_user.is_authenticated %}
                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user"></i> {{ current_user.real_name or current_user.username }}
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/profile"><i class="fas fa-user-edit"></i> 个人资料</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt"></i> 退出登录</a></li>
                            </ul>
                        </div>
                    {% else %}
                        <a class="nav-link" href="/login"><i class="fas fa-sign-in-alt"></i> 登录</a>
                        <a class="nav-link" href="/register"><i class="fas fa-user-plus"></i> 注册</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- 页面标题 -->
        <div class="row">
            <div class="col-12">
                <h2 class="mb-4">
                    <i class="fas fa-seedling text-success"></i>
                    种子推荐面板
                </h2>
                <p class="text-muted">基于地区气候条件和市场数据的种子品种推荐系统</p>
            </div>
        </div>

        <!-- 筛选条件 -->
        <div class="filter-section">
            <div class="row">
                <div class="col-md-3">
                    <label class="form-label">作物类型</label>
                    <select class="form-select" id="crop-type">
                        <option value="all">全部作物</option>
                        <option value="corn">玉米</option>
                        <option value="wheat">小麦</option>
                        <option value="rice">水稻</option>
                        <option value="soybean">大豆</option>
                        <option value="peanut">花生</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">种植地区</label>
                    <select class="form-select" id="region-select">
                        <option value="all">全国</option>
                        <option value="shandong">山东</option>
                        <option value="henan">河南</option>
                        <option value="hebei">河北</option>
                        <option value="jiangsu">江苏</option>
                        <option value="anhui">安徽</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">种植季节</label>
                    <select class="form-select" id="season-select">
                        <option value="spring">春季</option>
                        <option value="summer">夏季</option>
                        <option value="autumn">秋季</option>
                        <option value="winter">冬季</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">&nbsp;</label>
                    <button class="btn btn-primary d-block w-100" onclick="filterSeeds()">
                        <i class="fas fa-search"></i> 筛选推荐
                    </button>
                </div>
            </div>
        </div>

        <!-- 推荐种子列表 -->
        <div class="row" id="seed-recommendations">
            <!-- 种子卡片将通过JavaScript动态生成 -->
        </div>

        <!-- 价格趋势图表 -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="chart-container">
                    <h5>
                        <i class="fas fa-chart-line"></i>
                        种子价格趋势分析
                    </h5>
                    <div id="price-trend-chart" style="height: 400px;"></div>
                </div>
            </div>
        </div>

        <!-- 品种对比表 -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="chart-container">
                    <h5>
                        <i class="fas fa-table"></i>
                        品种详细对比
                    </h5>
                    <div class="table-responsive">
                        <table class="table table-hover" id="variety-comparison">
                            <thead class="table-light">
                                <tr>
                                    <th>品种名称</th>
                                    <th>适宜地区</th>
                                    <th>生长周期</th>
                                    <th>预期产量</th>
                                    <th>当前价格</th>
                                    <th>价格趋势</th>
                                    <th>推荐指数</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 表格内容将通过JavaScript动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 种子数据
        const seedData = [
            {
                id: 1,
                name: '先玉335',
                type: 'corn',
                region: ['shandong', 'henan', 'hebei'],
                season: ['spring', 'summer'],
                price: 2.8,
                trend: 'up',
                yield: '650kg/亩',
                cycle: '120天',
                recommendation: 95,
                description: '高产稳产，抗病性强，适应性广'
            },
            {
                id: 2,
                name: '济麦22',
                type: 'wheat',
                region: ['henan', 'shandong', 'anhui'],
                season: ['autumn', 'winter'],
                price: 3.2,
                trend: 'stable',
                yield: '550kg/亩',
                cycle: '240天',
                recommendation: 88,
                description: '优质强筋小麦，面粉品质优良'
            },
            {
                id: 3,
                name: '黄华占',
                type: 'rice',
                region: ['jiangsu', 'anhui'],
                season: ['spring', 'summer'],
                price: 4.5,
                trend: 'up',
                yield: '600kg/亩',
                cycle: '135天',
                recommendation: 92,
                description: '优质籼稻，米质优良，口感佳'
            },
            {
                id: 4,
                name: '中黄13',
                type: 'soybean',
                region: ['shandong', 'henan'],
                season: ['spring', 'summer'],
                price: 5.2,
                trend: 'down',
                yield: '200kg/亩',
                cycle: '110天',
                recommendation: 85,
                description: '高蛋白大豆，适合豆制品加工'
            },
            {
                id: 5,
                name: '花育25',
                type: 'peanut',
                region: ['shandong', 'henan'],
                season: ['spring', 'summer'],
                price: 6.8,
                trend: 'up',
                yield: '350kg/亩',
                cycle: '130天',
                recommendation: 90,
                description: '高油酸花生，营养价值高'
            }
        ];

        // 筛选种子
        function filterSeeds() {
            const cropType = document.getElementById('crop-type').value;
            const region = document.getElementById('region-select').value;
            const season = document.getElementById('season-select').value;

            let filteredSeeds = seedData.filter(seed => {
                let matchCrop = cropType === 'all' || seed.type === cropType;
                let matchRegion = region === 'all' || seed.region.includes(region);
                let matchSeason = seed.season.includes(season);
                
                return matchCrop && matchRegion && matchSeason;
            });

            // 按推荐指数排序
            filteredSeeds.sort((a, b) => b.recommendation - a.recommendation);

            displaySeeds(filteredSeeds);
            updateComparisonTable(filteredSeeds);
            updatePriceChart(filteredSeeds);
        }

        // 显示种子卡片
        function displaySeeds(seeds) {
            const container = document.getElementById('seed-recommendations');
            
            if (seeds.length === 0) {
                container.innerHTML = '<div class="col-12"><div class="alert alert-info">暂无符合条件的种子推荐</div></div>';
                return;
            }

            let html = '';
            seeds.forEach(seed => {
                const trendIcon = seed.trend === 'up' ? 'fa-arrow-up text-success' : 
                                seed.trend === 'down' ? 'fa-arrow-down text-danger' : 
                                'fa-minus text-warning';
                
                html += `
                    <div class="col-md-6 col-lg-4">
                        <div class="card seed-card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="card-title">${seed.name}</h5>
                                    <span class="recommendation-badge">${seed.recommendation}分</span>
                                </div>
                                <p class="card-text text-muted">${seed.description}</p>
                                <div class="row text-center mb-3">
                                    <div class="col-4">
                                        <small class="text-muted">预期产量</small>
                                        <div class="fw-bold">${seed.yield}</div>
                                    </div>
                                    <div class="col-4">
                                        <small class="text-muted">生长周期</small>
                                        <div class="fw-bold">${seed.cycle}</div>
                                    </div>
                                    <div class="col-4">
                                        <small class="text-muted">当前价格</small>
                                        <div class="fw-bold">
                                            ${seed.price}元/斤
                                            <i class="fas ${trendIcon} ms-1"></i>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-outline-primary btn-sm w-100" onclick="viewSeedDetail(${seed.id})">
                                    查看详情
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // 更新对比表
        function updateComparisonTable(seeds) {
            const tbody = document.querySelector('#variety-comparison tbody');
            
            let html = '';
            seeds.forEach(seed => {
                const trendIcon = seed.trend === 'up' ? '<i class="fas fa-arrow-up text-success"></i>' : 
                                seed.trend === 'down' ? '<i class="fas fa-arrow-down text-danger"></i>' : 
                                '<i class="fas fa-minus text-warning"></i>';
                
                const regionNames = {
                    'shandong': '山东',
                    'henan': '河南',
                    'hebei': '河北',
                    'jiangsu': '江苏',
                    'anhui': '安徽'
                };
                
                const regionText = seed.region.map(r => regionNames[r] || r).join('、');
                
                html += `
                    <tr>
                        <td><strong>${seed.name}</strong></td>
                        <td>${regionText}</td>
                        <td>${seed.cycle}</td>
                        <td>${seed.yield}</td>
                        <td>${seed.price}元/斤</td>
                        <td>${trendIcon}</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar bg-success" role="progressbar" 
                                     style="width: ${seed.recommendation}%" 
                                     aria-valuenow="${seed.recommendation}" 
                                     aria-valuemin="0" aria-valuemax="100">
                                    ${seed.recommendation}分
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // 更新价格图表
        function updatePriceChart(seeds) {
            const chart = echarts.init(document.getElementById('price-trend-chart'));
            
            // 生成模拟的价格趋势数据
            const months = ['1月', '2月', '3月', '4月', '5月', '6月'];
            const series = seeds.slice(0, 3).map(seed => ({
                name: seed.name,
                type: 'line',
                data: generatePriceTrend(seed.price, seed.trend),
                smooth: true
            }));
            
            const option = {
                title: {
                    text: '近6个月价格趋势',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: series.map(s => s.name),
                    top: 30
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: months
                },
                yAxis: {
                    type: 'value',
                    name: '价格(元/斤)'
                },
                series: series,
                color: ['#52c41a', '#1890ff', '#faad14']
            };
            
            chart.setOption(option);
            
            // 响应式处理
            window.addEventListener('resize', function() {
                chart.resize();
            });
        }

        // 生成价格趋势数据
        function generatePriceTrend(basePrice, trend) {
            const data = [];
            let currentPrice = basePrice * 0.9; // 起始价格
            
            for (let i = 0; i < 6; i++) {
                if (trend === 'up') {
                    currentPrice += (Math.random() * 0.2 - 0.05);
                } else if (trend === 'down') {
                    currentPrice -= (Math.random() * 0.2 - 0.05);
                } else {
                    currentPrice += (Math.random() * 0.1 - 0.05);
                }
                data.push(Math.max(0, parseFloat(currentPrice.toFixed(2))));
            }
            
            return data;
        }

        // 查看种子详情
        function viewSeedDetail(seedId) {
            const seed = seedData.find(s => s.id === seedId);
            if (seed) {
                alert(`${seed.name} 详细信息：\n\n${seed.description}\n\n预期产量：${seed.yield}\n生长周期：${seed.cycle}\n当前价格：${seed.price}元/斤\n推荐指数：${seed.recommendation}分`);
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            filterSeeds(); // 初始化显示
        });
    </script>
</body>
</html>
