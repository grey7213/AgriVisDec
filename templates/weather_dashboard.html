<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天气适宜度看板 - AgriDec</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <style>
        .navbar-brand {
            font-weight: bold;
            color: #52c41a !important;
        }
        .btn-primary {
            background-color: #52c41a;
            border-color: #52c41a;
        }
        .btn-primary:hover {
            background-color: #389e0d;
            border-color: #389e0d;
        }
        .weather-card {
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .weather-today {
            background: linear-gradient(135deg, #1890ff 0%, #40a9ff 100%);
            color: white;
        }
        .suitability-score {
            font-size: 2rem;
            font-weight: bold;
        }
        .score-excellent { color: #52c41a; }
        .score-good { color: #faad14; }
        .score-fair { color: #fa8c16; }
        .score-poor { color: #ff4d4f; }
        
        .activity-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #52c41a;
        }
        .activity-recommended { border-left-color: #52c41a; }
        .activity-caution { border-left-color: #faad14; }
        .activity-not-recommended { border-left-color: #ff4d4f; }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .weather-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        .forecast-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            margin: 5px;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-seedling"></i> AgriDec
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">数据看板</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/seed-dashboard">种子推荐</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/weather-dashboard">天气适宜度</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/machine-comparison">农具对比</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/farming-calendar">农事日历</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/purchase-module">农资采购</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- 页面标题 -->
        <div class="row">
            <div class="col-12">
                <h2 class="mb-4">
                    <i class="fas fa-cloud-sun text-info"></i>
                    天气适宜度看板
                </h2>
                <p class="text-muted">基于实时天气数据的农事活动适宜度评估系统</p>
            </div>
        </div>

        <!-- 地区选择 -->
        <div class="row mb-4">
            <div class="col-md-4">
                <select class="form-select" id="region-select" onchange="updateWeatherData()">
                    <option value="beijing">北京</option>
                    <option value="shanghai">上海</option>
                    <option value="guangzhou">广州</option>
                    <option value="chengdu">成都</option>
                    <option value="xian">西安</option>
                </select>
            </div>
        </div>

        <!-- 今日天气概况 -->
        <div class="row">
            <div class="col-md-8">
                <div class="card weather-card weather-today">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-4 text-center">
                                <i class="fas fa-sun weather-icon"></i>
                                <h3 id="current-temp">25°C</h3>
                                <p id="current-weather">晴</p>
                            </div>
                            <div class="col-md-8">
                                <h4>今日天气</h4>
                                <div class="row">
                                    <div class="col-6">
                                        <p><i class="fas fa-thermometer-half"></i> 温度范围: <span id="temp-range">18°C - 28°C</span></p>
                                        <p><i class="fas fa-tint"></i> 湿度: <span id="humidity">65%</span></p>
                                    </div>
                                    <div class="col-6">
                                        <p><i class="fas fa-wind"></i> 风速: <span id="wind-speed">3.2 m/s</span></p>
                                        <p><i class="fas fa-eye"></i> 能见度: <span id="visibility">10km</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card weather-card">
                    <div class="card-body text-center">
                        <h5>农事适宜度</h5>
                        <div class="suitability-score score-excellent" id="suitability-score">85</div>
                        <p class="text-muted">综合评分</p>
                        <div class="progress">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 85%" id="suitability-bar"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 7天天气预报 -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="chart-container">
                    <h5>
                        <i class="fas fa-calendar-alt"></i>
                        7天天气预报
                    </h5>
                    <div class="row" id="forecast-container">
                        <!-- 预报项目将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 农事活动建议 -->
        <div class="row mt-4">
            <div class="col-md-6">
                <h5>
                    <i class="fas fa-check-circle text-success"></i>
                    推荐农事活动
                </h5>
                <div id="recommended-activities">
                    <!-- 推荐活动将通过JavaScript动态生成 -->
                </div>
            </div>
            <div class="col-md-6">
                <h5>
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                    注意事项
                </h5>
                <div id="weather-warnings">
                    <!-- 注意事项将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <!-- 温度和湿度趋势图 -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="chart-container">
                    <h5>
                        <i class="fas fa-chart-line"></i>
                        温度趋势
                    </h5>
                    <div id="temperature-chart" style="height: 300px;"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-container">
                    <h5>
                        <i class="fas fa-chart-area"></i>
                        湿度变化
                    </h5>
                    <div id="humidity-chart" style="height: 300px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 天气数据
        const weatherData = {
            beijing: {
                current: { temp: 25, weather: '晴', humidity: 65, windSpeed: 3.2, tempRange: '18°C - 28°C' },
                forecast: [
                    { date: '今天', temp: 25, weather: '晴', icon: 'fa-sun' },
                    { date: '明天', temp: 27, weather: '多云', icon: 'fa-cloud-sun' },
                    { date: '后天', temp: 23, weather: '小雨', icon: 'fa-cloud-rain' },
                    { date: '周四', temp: 21, weather: '阴', icon: 'fa-cloud' },
                    { date: '周五', temp: 26, weather: '晴', icon: 'fa-sun' },
                    { date: '周六', temp: 28, weather: '晴', icon: 'fa-sun' },
                    { date: '周日', temp: 24, weather: '多云', icon: 'fa-cloud-sun' }
                ]
            },
            shanghai: {
                current: { temp: 28, weather: '多云', humidity: 70, windSpeed: 2.8, tempRange: '22°C - 30°C' },
                forecast: [
                    { date: '今天', temp: 28, weather: '多云', icon: 'fa-cloud-sun' },
                    { date: '明天', temp: 30, weather: '晴', icon: 'fa-sun' },
                    { date: '后天', temp: 26, weather: '小雨', icon: 'fa-cloud-rain' },
                    { date: '周四', temp: 24, weather: '中雨', icon: 'fa-cloud-showers-heavy' },
                    { date: '周五', temp: 27, weather: '多云', icon: 'fa-cloud-sun' },
                    { date: '周六', temp: 29, weather: '晴', icon: 'fa-sun' },
                    { date: '周日', temp: 31, weather: '晴', icon: 'fa-sun' }
                ]
            }
        };

        // 更新天气数据
        function updateWeatherData() {
            const region = document.getElementById('region-select').value;
            const data = weatherData[region] || weatherData.beijing;
            
            // 更新当前天气
            document.getElementById('current-temp').textContent = data.current.temp + '°C';
            document.getElementById('current-weather').textContent = data.current.weather;
            document.getElementById('temp-range').textContent = data.current.tempRange;
            document.getElementById('humidity').textContent = data.current.humidity + '%';
            document.getElementById('wind-speed').textContent = data.current.windSpeed + ' m/s';
            
            // 更新适宜度评分
            const score = calculateSuitabilityScore(data.current);
            updateSuitabilityScore(score);
            
            // 更新7天预报
            updateForecast(data.forecast);
            
            // 更新农事建议
            updateFarmingAdvice(data.current, score);
            
            // 更新图表
            updateCharts(data.forecast);
        }

        // 计算适宜度评分
        function calculateSuitabilityScore(current) {
            let score = 100;
            
            // 温度适宜性 (20-30度最适宜)
            if (current.temp < 15 || current.temp > 35) {
                score -= 30;
            } else if (current.temp < 20 || current.temp > 30) {
                score -= 15;
            }
            
            // 湿度适宜性 (50-80%最适宜)
            if (current.humidity < 40 || current.humidity > 90) {
                score -= 20;
            } else if (current.humidity < 50 || current.humidity > 80) {
                score -= 10;
            }
            
            // 风速适宜性 (1-5m/s最适宜)
            if (current.windSpeed > 8) {
                score -= 25;
            } else if (current.windSpeed > 5) {
                score -= 10;
            }
            
            return Math.max(0, Math.min(100, score));
        }

        // 更新适宜度评分显示
        function updateSuitabilityScore(score) {
            const scoreElement = document.getElementById('suitability-score');
            const barElement = document.getElementById('suitability-bar');
            
            scoreElement.textContent = score;
            barElement.style.width = score + '%';
            
            // 更新颜色
            scoreElement.className = 'suitability-score ';
            if (score >= 80) {
                scoreElement.className += 'score-excellent';
                barElement.className = 'progress-bar bg-success';
            } else if (score >= 60) {
                scoreElement.className += 'score-good';
                barElement.className = 'progress-bar bg-warning';
            } else if (score >= 40) {
                scoreElement.className += 'score-fair';
                barElement.className = 'progress-bar bg-warning';
            } else {
                scoreElement.className += 'score-poor';
                barElement.className = 'progress-bar bg-danger';
            }
        }

        // 更新7天预报
        function updateForecast(forecast) {
            const container = document.getElementById('forecast-container');
            let html = '';
            
            forecast.forEach(day => {
                html += `
                    <div class="col forecast-item">
                        <div class="forecast-date">${day.date}</div>
                        <i class="fas ${day.icon} text-primary" style="font-size: 2rem;"></i>
                        <div class="forecast-temp">${day.temp}°C</div>
                        <div class="forecast-weather">${day.weather}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // 更新农事建议
        function updateFarmingAdvice(current, score) {
            const recommendedContainer = document.getElementById('recommended-activities');
            const warningsContainer = document.getElementById('weather-warnings');
            
            let recommended = [];
            let warnings = [];
            
            // 基于天气条件生成建议
            if (score >= 80) {
                recommended.push('适宜进行播种作业');
                recommended.push('可以进行田间管理');
                recommended.push('适合农药喷洒');
            } else if (score >= 60) {
                recommended.push('可进行轻度田间作业');
                recommended.push('适合室内农事准备');
            }
            
            if (current.temp > 30) {
                warnings.push('温度较高，注意防暑降温');
                warnings.push('避免中午时段户外作业');
            }
            
            if (current.humidity > 80) {
                warnings.push('湿度较高，注意通风');
                warnings.push('预防病虫害发生');
            }
            
            if (current.windSpeed > 5) {
                warnings.push('风力较大，暂停喷药作业');
                warnings.push('加固农业设施');
            }
            
            // 显示推荐活动
            let recommendedHtml = '';
            recommended.forEach(activity => {
                recommendedHtml += `
                    <div class="activity-card activity-recommended">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        ${activity}
                    </div>
                `;
            });
            recommendedContainer.innerHTML = recommendedHtml;
            
            // 显示注意事项
            let warningsHtml = '';
            warnings.forEach(warning => {
                warningsHtml += `
                    <div class="activity-card activity-caution">
                        <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                        ${warning}
                    </div>
                `;
            });
            warningsContainer.innerHTML = warningsHtml;
        }

        // 更新图表
        function updateCharts(forecast) {
            // 温度趋势图
            const tempChart = echarts.init(document.getElementById('temperature-chart'));
            const tempOption = {
                tooltip: { trigger: 'axis' },
                xAxis: {
                    type: 'category',
                    data: forecast.map(f => f.date)
                },
                yAxis: {
                    type: 'value',
                    name: '温度(°C)'
                },
                series: [{
                    name: '温度',
                    type: 'line',
                    data: forecast.map(f => f.temp),
                    smooth: true,
                    itemStyle: { color: '#1890ff' },
                    areaStyle: { opacity: 0.3 }
                }]
            };
            tempChart.setOption(tempOption);
            
            // 湿度变化图
            const humidityChart = echarts.init(document.getElementById('humidity-chart'));
            const humidityData = forecast.map(() => Math.floor(Math.random() * 30) + 50); // 模拟湿度数据
            const humidityOption = {
                tooltip: { trigger: 'axis' },
                xAxis: {
                    type: 'category',
                    data: forecast.map(f => f.date)
                },
                yAxis: {
                    type: 'value',
                    name: '湿度(%)'
                },
                series: [{
                    name: '湿度',
                    type: 'bar',
                    data: humidityData,
                    itemStyle: { color: '#52c41a' }
                }]
            };
            humidityChart.setOption(humidityOption);
            
            // 响应式处理
            window.addEventListener('resize', function() {
                tempChart.resize();
                humidityChart.resize();
            });
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateWeatherData();
        });
    </script>
</body>
</html>
